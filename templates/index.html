<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>データ移行</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            overflow: hidden; /* 画像がはみ出さないようにする */
            background-color: #f0f0f0;
        }

        /* コンテナで2つの四角形を横に並べる */
        .container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: 100%;
        }

        /* 各四角形のスタイル */
        .frame-rect {
            width: 400px;
            height: 600px;
            border: 2px solid #ccc; /* 白い輪郭線 */
            background-color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center; /* 左寄せに変更 */
            position: relative;
            padding: 20px;
            box-sizing: border-box;
        }

        .progress-container {
            width: 100%;
            background-color: #ddd;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px; /* プログレスバーの上部マージン */
        }

        .progress-bar {
            height: 30px;
            width: 0%;
            background-color: #4CAF50;
            text-align: start;
            color: white;
            line-height: 30px; /* テキストを中央に表示 */
        }

        /* 移行開始ボタンを中央下に配置 */
        .start-button-container {
            position: absolute;
            /* bottom: 20px;
            left: 50%;
            transform: translateX(-50%); */
        }

        button {
            padding: 10px 20px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:disabled {
            background-color: grey;
        }

        .status {
            margin: 20px 0;
            font-size: 18px;
            color: #333;
        }

        /* 新旧サーバーラベルのスタイル */
        .server-label {
            font-size: 18px;
            background-color: #ddd;
            border: none;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 20px;
        }


        /*### 以降画像についての処理 ###*/  
        /* 挿入画像の初期状態 */
        /*  startManyCardboardBoxesImg...manybox.png
            carImg ...car.png
            fewCardboardBoxImg...box.png
            completedManyCardboardBoxesImg...manybox.png
        */      

         .start-few-cardboardBoxes-image, 
         .car-image, 
         .start-many-cardboardBoxes-image, 
         .completed-many-cardboardBoxes-image {
            width: 115px;
            display: none;
            position: absolute;
        }

        /* 大きい段ボール画像を左に配置 */
        .start-few-cardboardBoxes-image {
            top: 60%;
            right: calc(25% - 100px);
        }

        /* 車画像を動かす位置（初期は左に配置） */
        .car-image {
            top: 65%;
            left: calc(25%); /* 初期位置は車と同じ */
        }

        /* 小さい段ボール画像を右に配置 */
        .start-many-cardboardBoxes-image {
            top: 60%;
            left: calc(25% - 100px);
        }

        /* 移行終了時表示用, 大きい段ボール画像を右に配置 */
        .completed-many-cardboardBoxes-image {
            top: 60%;
            right: calc(25% - 100px);
        }

        /* アニメーション */
        @keyframes moveCar {
            0% {
                left: 25%; /* 車の初期位置 */
            }
            100% {
                left: calc(60%); /* 車の位置 */
            }
        }

        /* アニメーションを適用 */
        .move {
            animation: moveCar 3s linear infinite; /* 3秒で左から右に移動し続ける */
        }        

    </style>
</head>
<body>
    <!-- 2つの新旧を隔てる四角形を横並びに描画 -->
    <div class="container">
        <!-- 左の旧サーバを表す四角形内の描画処理 -->
        <div class="frame-rect">
            <!-- 旧サーバのラベル -->
            <div class="server-label">従来の方法</div>
            <!-- 段ボール・車の画像描画 -->
            <img class="start-few-cardboardBoxes-image" id="few-boxes-left" src="images/box.png" alt="1つ段ボール左">
            <img class="start-many-cardboardBoxes-image" id="many-boxes-left" src="images/manybox.png" alt="多段ボール左">
            <img class="car-image" id="car-left" src="images/car.png" alt="車左">
            <img class="completed-many-cardboardBoxes-image" id="completed-many-boxes-left" src="images/manybox.png" alt="多段ボール左の右">
            <!-- プログレスバーの描画 -->
            <div class="progress-container">
                <div class="progress-bar" id="progressBar-left">0.0%</div>
            </div>
            <div class="status" id="status-left">Let's start !</div>
        </div>


        <!-- 右の新サーバを表す四角形内の描画処理 -->
        <div class="frame-rect">
            <!-- 新サーバのラベル -->
            <div class="server-label">新提案アルゴリズム</div>
            <!-- 段ボール・車の画像描画 -->
            <img class="start-few-cardboardBoxes-image" id="few-boxes-right" src="images/box.png" alt="1つ段ボール右">
            <img class="start-many-cardboardBoxes-image" id="many-boxes-right" src="images/manybox.png" alt="多段ボール右">
            <img class="car-image" id="car-right" src="images/car.png" alt="車右">
            <img class="completed-many-cardboardBoxes-image" id="completed-many-boxes-right" src="images/manybox.png" alt="多段ボール右の右">
            <!-- プログレスバーの描画 -->
            <div class="progress-container">
                <div class="progress-bar" id="progressBar-right">0.0%</div>
            </div>
            <div class="status" id="status-right">Let's start !</div>
        </div>
    </div>

    <!-- 移行開始ボタンを四角形の下中央に配置 -->
    <div class="start-button-container">
        <button onclick="startMigration()">データ移行開始</button>
    </div>

    <script>
        /* データ移行処理を開始 */
        // ↑のdivタグにおいて,ボタンクリック時にstartMigration()を実行, idはjavascriptsからこのボタンを特定するための演算子
        function startMigration() {
            const sides = ['left', 'right']; // 左と右の両方で処理を行う
            const button = document.querySelector('button'); // querySelectorはhtmlから任意のhtml要素を取得（ボタンタグ呼び出しってこと？）
            const migratingPercent = {};
            // pyでいう for elm in list: みたいな構文のやつ 
            sides.forEach(side => {
                const progressBar = document.getElementById(`progressBar-${side}`); // sideに左右が入ることで、上記の左右四角形内の描画を同時に行う
                migratingPercent[side] = document.getElementById(`status-${side}`);
                const car = document.getElementById(`car-${side}`);
                const fewBoxes = document.getElementById(`few-boxes-${side}`); // 小数段ボール
                const manyBoxes = document.getElementById(`many-boxes-${side}`); // 多数段ボール
                const completedBoxes = document.getElementById(`completed-many-boxes-${side}`) // 終了時、各ブロック右用の多数段ボールの用意

                //// クリック直後の処理 ////
                // 車を表示してアニメーション開始
                manyBoxes.style.display = 'block';
                fewBoxes.style.display = 'block';
                car.style.display = 'block';
                car.classList.add('move');
                button.textContent = 'データ移行中';
                button.disabled = true;

                //// 進捗状況を更新する処理 ////
                // 変数の初期化
                let currentNum = 0; // 現在の処理回数を表す。そのため、後の関数内でインクリメントされる
                let wholePercentNum; // この回数だけupdateProgree()を実行。つまり、計算用の対象となるデータ全体から算出した全体値の変数
                if (side == "left") {
                    wholePercentNum = 100; // 左の従来ブロックではプログレスバーの増加を遅くする
                } else {
                    wholePercentNum = 50 // 右の新提案ブロックではプログレスバーの増加を早くする
                }
                const updateInterval = 50; // 0.05secごとに更新

                // データ移行の割合を計算して表示させる関数（プログレスバーの更新処理）
                function updateProgress() {
                    if (currentNum < wholePercentNum) {
                        currentNum++;
                        let currentPercent = (currentNum / wholePercentNum) * 100; // 現在の進捗状況をパーセントで表すための変数定義
                        migratingPercent[side].textContent = `...移行中...`; // パーセンテージを小数点第一位まで表示させる
                        progressBar.style.width = `${currentPercent}%`; // プログレスバーの幅を更新
                        progressBar.textContent = `${currentPercent.toFixed(1)}%`; // プログレスバーのテキストを更新（小数点第一位まで表示）
                        setTimeout(updateProgress, updateInterval); // 再帰呼び出し, 0.05sec後に再度実行
                    } else {
                        migratingPercent[side].textContent = "移行完了"; // 100%に設定
                        progressBar.style.width = '100%'; // プログレスバーを100%にする
                        progressBar.textContent = "100.0%";
                        
                        // 移行完了後の処理
                        car.style.display = 'none'; // 車消す
                        fewBoxes.style.display = 'none'; // 各ブロック左の小数段ボール削除
                        manyBoxes.style.display = 'none'; // 各ブロック右の多数段ボール削除
                        completedBoxes.style.display = 'block'; // 移行完了を示す右多段ボール画像表示
                    }

                    if (migratingPercent["left"].textContent === "移行完了" && migratingPercent["right"].textContent === "移行完了"){
                        button.textContent = "データ移行完了"; // 移行完了テキストを描画
                    }
                }

                updateProgress(); // プログレスバーの更新を開始（最初の実行）
            });
        }
    </script>
</body>
</html>